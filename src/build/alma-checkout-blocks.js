(()=>{"use strict";const e=window.React,n=window.wp.element,a=({settings:a,setSelectedFeePlan:t})=>((0,n.useEffect)((()=>{a?.eligibilities&&t(a?.eligibilities.general_2_0_0.installmentsCount)}),[a]),console.log("Ca fonciiitonne !!",a,t),(0,e.createElement)(e.Fragment,null,(0,e.createElement)("div",null,a?.description),(0,e.createElement)("div",null,a.eligibilities&&Object.values(a.eligibilities).map(((n,a)=>(0,e.createElement)("button",{onClick:e=>((e,n)=>{e.preventDefault(),console.log(n);const a=`general_${n.installmentsCount}_${n.deferredDays}_${n.deferredMonths}`;t(a)})(e,n),key:a},n.installmentsCount))))));!function(t){const o=["alma_in_page_pay_now","alma","alma_pay_later","alma_pay_now","alma_pnx_plus_4","alma_pa"];var l=void 0,i=!1,_={},c={};for(const s in o){const r=window.wc.wcSettings.getSetting(`${o[s]}_data`,null);if(!r)continue;const m=window.wp.htmlEntities.decodeEntities(r.title);function p(t){const[o,l]=(0,n.useState)(null);(0,n.useEffect)((()=>{console.log("useEffect!",o)}),[o]);const{eventRegistration:i,emitResponse:s}=t;if(!r.is_in_page){const{onPaymentProcessing:t}=i;return(0,n.useEffect)((()=>{const e=t((async()=>{const e={[`alma_checkout_nonce${r.gateway_name}`]:`${r.nonce_value}`,alma_fee_plan:o,payment_method:r.gateway_name};return{type:s.responseTypes.SUCCESS,meta:{paymentMethodData:e}}}));return()=>{e()}}),[s.responseTypes.ERROR,s.responseTypes.SUCCESS,t]),(0,e.createElement)(a,{settings:r,setSelectedFeePlan:l})}return _=t.billing.billingAddress,t.shippingData.shippingAddress&&(c=t.shippingData.shippingAddress),(0,e.createElement)("div",{id:"alma-inpage-alma_in_page_pay_now"})}const d={name:r.gateway_name,label:m,content:(0,e.createElement)(p,null),edit:(0,e.createElement)(p,null),placeOrderButtonLabel:r.label_button,canMakePayment:()=>!0,ariaLabel:m};window.wc.wcBlocksRegistry.registerPaymentMethod(d),r.is_in_page&&(i=!0)}window.addEventListener("load",(e=>{if(i){var n=window.wc.wcSettings.getSetting("alma_in_page_pay_now_data",null);!function(e){void 0!==l&&null!==document.getElementById("alma-embedded-iframe")&&l.unmount(),l=Alma.InPage.initialize({merchantId:e.merchant_id,amountInCents:e.amount_in_cents,installmentsCount:"1",selector:"#alma-inpage-alma_in_page_pay_now",environment:e.environment,locale:e.locale})}(n)}document.getElementsByClassName("wc-block-components-checkout-place-order-button")[0].addEventListener("click",(e=>{e.stopPropagation();var a={action:"alma_do_checkout_in_page",fields:{billing:_,shipping:c,customer_note:"",alma_fee_plan:"general_1_0_0",alma_checkout_noncealma_in_page_pay_now:n.nonce_value,payment_method:"alma_in_page_pay_now"},"woocommerce-process-checkout-nonce":n.woocommerce_process_checkout_nonce,payment_method:"alma_in_page_pay_now",alma_fee_plan:"general_1_0_0",alma_fee_plan_in_page:"general_1_0_0",is_woo_block:!0};jQuery.post(ajax_object.ajax_url,a).done((function(e){var n=e.data.payment_id,a=e.data.order_id;l.startPayment({paymentId:n,onUserCloseModal:()=>{!function(e){var n={action:"alma_cancel_order_in_page",order_id:e};jQuery.post(ajax_object.ajax_url,n)}(a),t(".alma-loader-wrapper").remove()}})})).fail((function(e){location.reload()}))}))}))}(jQuery)})();